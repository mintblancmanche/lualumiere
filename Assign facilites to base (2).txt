local newbase = ScenEdit_GetUnit({guid=ScenEdit_GetKeyValue("newbase_guid") })
local facilities = ScenEdit_GetKeyValue("facities")

-- for any facilities at base, attach them
if facilities ~= '' then

    local unitlist = {}
    -- break down the string into a table
    local i = 1
    for word in string.gmatch(facilities, '([^, ]+)' )  do
        unitlist[i] = word
	print(word)
        i = i +1
    end

    i = 1
    local unit = ScenEdit_GetUnit({guid =unitlist[i]})
    ScenEdit_SetUnitSide({side=ScenEdit_GetKeyValue("side1"), name=unit.guid, newside=ScenEdit_GetKeyValue("side2")} )
    unit.group = newbase.guid

    if #unitlist == 1 then
        facilities  = ''
        local ev = ScenEdit_SetEvent('Assign facilites to base',{isActive = false})
    else
        -- drop this unit
        table.remove(unitlist, 1 )
        facilities  = table.concat(unitlist, ',' )
    end
    -- save remaining faciities
    ScenEdit_SetKeyValue("facities",  facilities )

else

    ScenEdit_MsgBox('Securedmessage.', 6)
    local ev = ScenEdit_SetEvent('Assign facilites to base',{isActive = false})

end

