local pattern = string.format("([^%s]+)", 123, 456)
print(pattern)

function split(s, sep)
    local fields = {}
    local sep = sep or " "
    local pattern = string.format("([^%s]+)", sep)
    local x, y = string.gsub(s, pattern, function(c) fields[#fields + 1] = c end)
    print(x)
    print(y)
    return fields
end

split("123,456,789", ",")

 Luaのパターンは、パターンマッチ関数 string.find、 string.gmatch、 string.gsub、 string.match によってパターンとして解釈される正規文字列によって記述されます。 この節ではこれらの文字列の構文と意味 (つまり何にマッチするのか) を説明します。
文字クラス

文字クラスは文字の集合を表すために使われます。 文字クラスの記述では以下の組み合わせが使えます。

    x: (ただしxは魔法の文字^$()%.[]*+-?のいずれでもない) 文字x自身を表します。
    .: (ドット) すべての文字を表します。
    %a: すべての英字を表します。
    %l: すべての小文字を表します。
    %u: すべての大文字を表します。
    %d: すべての数字を表します。
    %c: すべての制御文字を表します。
    %w: すべての英数字を表します。
    %g: 空白以外のすべての印刷可能文字を表します。

    %p: すべての句読点文字を表します。
    %s: すべての空白文字を表します。


    %x: すべての16進数字を表します。
    %x: (ただしxは英数以外の任意の文字) 文字xを表します。 これは魔法の文字をエスケープする標準的な方法です。 英数以外のあらゆる文字 (魔法でない文字も含むすべての句読点文字が含まれます) は、前に '%' を付けることでパターン中でそれ自身を表すことができます。
    [set]: setの中のすべての文字の和集合であるクラスを表します。 '-' を使って範囲の終わりの文字を区切ることによって、その範囲の文字を指定することができます。 範囲は昇順です。 上で説明したすべてのクラス %x はsetの中でも部品として使うことができます。 setの中のそれ以外の文字はすべてそれ自身を表します。 例えば [%w_] (または [_%w]) はすべての英数字にアンダースコアを加えたものを表し、 [0-7] は8進数字を表し、 [0-7%l%-] は8進数字に小文字と '-' 文字を加えたものを表します。

    範囲とクラスの相互作用は定義されていません。 そのため [%a-z] や [a-%%] といったパターンは無意味です。
    [^set]: setの補集合を表します。 setは上で述べた通りに解釈されます。

ひとつの文字で表されているクラス (%a、%c など) はすべて、対応する大文字でそのクラスの補集合を表します。 例えば %S は空白以外のすべての文字を表します。

英字、空白などの文字グループは現在のロケールに依存します。 例えば、クラス [a-z] と %l は同等でない場合があります。
パターン項目

パターン項目は以下のいずれかです。

    単一の文字クラス。 そのクラス中の任意の1文字にマッチします。
    単一の文字クラスに '*' が続いたもの。 そのクラス中の文字の0回以上の繰り返しにマッチします。 これらの繰り返し項目は必ず最も長いマッチ可能な並びにマッチします。
    単一の文字クラスに '+' が続いたもの。 そのクラス中の文字の1回以上の繰り返しにマッチします。 これらの繰り返し項目は必ず最も長いマッチ可能な並びにマッチします。
    単一の文字クラスに '-' が続いたもの。 そのクラス中の文字の0回以上の繰り返しにマッチします。 '*' と異なり、 これらの繰り返し項目は必ず最も短いマッチ可能な並びにマッチします。
    単一の文字クラスに '?' が続いたもの。 そのクラス中の文字の0回または1回の出現にマッチします。 可能であれば常に1回の出現にマッチします。
    %n (ただしnは1から9) この項目はn番目のキャプチャした文字列 (後述) と等しい部分文字列にマッチします。
    %bxy (ただしxとyは2つの別々の文字) この項目は、xで始まりyで終わる、xとyの釣り合いが取れている文字列にマッチします。 つまり、文字列を左から右に読み進み、xのときに+1、yのときに-1をカウントするとき、最初にカウントが0になったyが終わりのyになります。 例えば、項目 %b() は括弧の釣り合いが取れている式にマッチします。
    %f[set] (境界パターン) この項目は、次の文字がsetに属し、前の文字がsetに属しない、任意の位置の空文字列にマッチします。 集合setは先程説明したように解釈されます。 対象の先頭と末尾は文字 '\0' があるかのように処理されます。
